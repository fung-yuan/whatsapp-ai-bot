# üöÄ WAHA Client Manager - Usage Guide

The `manage-waha.sh` script makes it easy to manage multiple WAHA instances for different clients.

## Quick Start

```bash
./manage-waha.sh
```

## Features

- ‚úÖ **Add New Clients** - Interactive setup with auto-generated credentials
- üìä **Port Scanning** - Auto-detect available ports (3000-3010)
- üìã **List Clients** - View all clients with credentials and status
- ‚è∏Ô∏è **Stop Clients** - Temporarily stop a client's container
- üóëÔ∏è **Remove Clients** - Safely delete client and cleanup data

## Requirements

- Docker installed and running
- `jq` for JSON processing: `sudo apt install jq -y`
- `openssl` for key generation (usually pre-installed)

## Menu Options

### [1] Add New Client

Creates a new WAHA instance for a client:

1. Scans for available ports
2. Asks for client name
3. Lets you choose a port
4. Generates API key (or use custom)
5. Creates Docker container
6. Displays dashboard credentials

**Example:**
```
Enter client name: Coffee Shop
Select port [3000-3010]: 3001
Generate API key automatically? [Y/n]: Y

‚úÖ Client Created!
Dashboard: http://YOUR_IP:3001/dashboard
Username: admin
Password: a8f4e2c9b1d7f3a6
```

### [2] List All Clients

Shows all configured clients with:
- Status (Running/Stopped)
- Port number
- Dashboard URL + credentials
- API key
- Uptime

### [3] Stop Client

Temporarily stops a client's container without deleting data.

### [4] Remove Client

Permanently deletes a client:
- Stops container
- Removes container
- Deletes volume data
- Updates config file

**‚ö†Ô∏è Requires typing client name to confirm**

## Config File

Client data is stored in `.waha-clients.json`:

```json
{
  "clients": [
    {
      "name": "Coffee Shop",
      "port": 3001,
      "apiKey": "waha_abc123...",
      "container": "waha_coffee_shop",
      "dashboard": {
        "username": "admin",
        "password": "a8f4e2c9..."
      },
      "created": "2024-12-24T12:00:00Z"
    }
  ]
}
```

**Keep this file safe!** It contains all credentials.

## Port Management

- **Range:** 3000-3010 (11 ports)
- **Displays:** First 5 available ports
- **Capacity:** 11 clients maximum (configurable)

To increase capacity, edit script:
```bash
PORT_START=3000
PORT_END=3020  # Change to 3020 for 21 ports
```

## Tips

1. **Save Credentials** - Write down dashboard password immediately
2. **One Port Per Client** - Each client gets dedicated container
3. **Check Status** - Use option [2] to see all credentials anytime
4. **Backup Config** - Keep `.waha-clients.json` backed up

## Troubleshooting

### "All ports in use"
- Remove unused clients with option [4]
- OR increase `PORT_END` in script

### "Container failed to create"
- Check Docker is running: `docker ps`
- Check port isn't used by another app: `netstat -tulpn | grep :3000`

### "Credentials not found"
- Wait 10 seconds after creation, then check option [2]
- OR check manually: `docker logs waha_CLIENT_NAME`

## Integration with n8n

After creating a client:

1. Note the port number (e.g., 3001)
2. In n8n workflow:
   - Update "Download Audio" URL: `http://YOUR_IP:3001{{ $json.mediaPath }}`
   - Update WAHA credential with new port
3. Scan QR code in dashboard
4. Test by sending message

## Security

- API keys are randomly generated (32 hex chars)
- Dashboard passwords are auto-generated by WAHA
- All credentials stored in `.waha-clients.json`
- Add `.waha-clients.json` to `.gitignore` (already done)

---

**Need help?** Open an issue on GitHub!
